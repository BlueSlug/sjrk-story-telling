<html>
<head>
<title>Social Justice Repair Kit Storytelling Project</title>
<script src="node_modules/infusion/dist/infusion-all.js"></script>
<script src="node_modules/gpii-binder/src/js/binder.js"></script>
<script src="node_modules/gpii-binder/src/js/transforms.js"></script>
<script src="node_modules/sjrk-storytelling/src/js/templatedComponent.js"></script>
<script src="node_modules/sjrk-storytelling/src/js/transforms.js"></script>

<script src="node_modules/sjrk-storytelling/src/js/storyTelling-story.js"></script>
<script src="node_modules/sjrk-storytelling/src/js/storyTelling-story-storyEditor.js"></script>
<script src="node_modules/sjrk-storytelling/src/js/storyTelling-story-storyViewer.js"></script>

<script src="node_modules/sjrk-storytelling/src/js/storyTelling-storyAuthoring.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gridlex/2.4.0/gridlex.min.css" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.css">

<link rel="stylesheet" href="node_modules/sjrk-storytelling/src/css/storyTelling.css" />

</head>
<body>
<h1>
    Social Justice Repair Kit Storytelling Project
</h1>
<div class="grid-12">
    <div class="col-4">
        <h2 class="sjrk-storyTelling-story-heading">My Story</h2>
    </div>
    <div class="col-4">
        <a class="sjrk-storyTelling-readOtherStories" href="#">Read Other Stories</a>
    </div>
</div>
<div class="grid-12">
    <div class="col-4">
        <a href="index_fr.html">FR</a>
    </div>
</div>

<div class="grid-12">
    <div class="col-8">
        <div class="srjkc-storyTelling sjrk-storyTelling"></div>
    </div>
</div>


<script>
    var storyTelling = sjrk.storyTelling.storyAuthoring(".srjkc-storyTelling", {
        resourceLoaderConfig: {
            resourcePrefix: "node_modules/sjrk-storytelling"
        },
        listeners: {
            "onStoryEditorReady.loadStoryFromQueryParam":
            {
                funcName: "sjrk.storyTelling.storyAuthoring.loadStoryFromQueryParam"
            }
        }
    });

    // classic query string parser via
    // https://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    sjrk.storyTelling.storyAuthoring.loadStoryFromQueryParam = function () {

        var storyId = getParameterByName("story");
        var storyURL = "http://localhost:8081/story/" + storyId;
        console.log(storyURL);

        $.get(storyURL, function (data) {
            var retrievedStory = JSON.parse(data);
            console.log(retrievedStory);
            storyTelling.storyEditor.applier.change("", retrievedStory);
        });
    }

</script>

</body>
</html>
